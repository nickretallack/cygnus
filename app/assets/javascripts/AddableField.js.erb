AddableField = (function(){

  var AddableField = function(element){

    var self = this;

    self.field = element;
    self.area = element.siblings(".addable-area");
    self.addable = self.field.children().last();
    self.button = $("<i />", {
      class: "material-icons medium-small",
      text: "<%= CONFIG[:button_icons][:add] %>",
    });

    self.button.on("click.AddableField", function(){
      self.add();
    });

    self.area.append(self.button);
    self.area.css({
      height: self.field.outerHeight()
    });

  };

  Make.extend(AddableField.prototype, {

    add: function(){
      var self = this;
      var addable = self.addable.clone();
      if(addable.is("select")){
        addable.children().removeAttr("selected");
      }
      var nameArray = self.addable.attr("name").toArray();
      nameArray[nameArray.length - 1] = parseInt(nameArray.last()) + 1;
      var name = nameArray.parse();
      addable.attr("name", name);
      addable.attr("id", name);
      self.addable = addable;
      self.field.append(addable);
      self.area.css({
        height: self.field.outerHeight()
      });
    }

  });

  return AddableField;

})();