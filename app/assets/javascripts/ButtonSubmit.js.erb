ButtonSubmit = (function(){

  var ButtonSubmit = function(element){

    var self = this;

    self.form = element;
    self.area = element.nextAll(".button-area").first();
    self.icons = JSON.parse('<%= CONFIG[:button_icons].to_json %>');

  };

  Make.extend(ButtonSubmit.prototype, {

    initialize: function(){
      var self = this;
      $.each(self.icons, function(name, icon){
        var button = self.form.find("#" + name);
        if(!button.exists()) return;
        if(button.attr("area")) self.area = self.form.nextAll(".button-area").eq(parseInt(button.attr("area")));
        var size = /small|medium-small|medium|large/.exec(button.attr("class"));
        size = size === null? "medium-small" : size.first();
        if(self.form.attr("edit")){
          var form = $("#" + self.form.attr("edit"));
          if(!form.exists()){
            switch(name){
              case "edit":
                var on = form.children(".on");
                var off = form.children(".off");
                on.hide();
                button.on("click.ButtonSubmit", function(event){
                  pause(event);
                  off.hide();
                  on.show();
                });
                break;
              case "save":
                button.on("click.ButtonSubmit", function(event){
                  pause(event);
                  form.submit();
                });
                break;
            }
          }
        }
        var div, icon;
        self.area.append((div = $("<div />", {
          css: {
            float: "left",
            cursor: "pointer"
          }
        })).append(
          (icon = $("<i />", {
            class: "material-icons " + size,
            id: button.attr("value"),
            text: icon,
            title: name.capitalize()
          })),
          $("<label />", {
            text: button.attr("value"),
            css: {
              display: "block"
            }
          })
        ).on("mouseenter.ButtonSubmit", function(){
          div.addClass("icon-hover");
        }).on("mouseleave.ButtonSubmit", function(){
          div.removeClass("icon-hover");
        }).on("click.ButtonSubmit", function(event){
          pause(event);
          if(name === "delete" && button.is("[confirm]")){
            if(confirm(button.attr("confirm"))){
              icon.replaceWithSpinner();
              button.trigger("click");
            }
          }else{
            switch(name){
              case "back":
                window.location.replace(self.form.attr("action"));
                break;
              case "edit":
                $(".editable").hide();
                $(".editing").show();
                break;
              case "attach":
                self.form.siblings().find("."+self.form.attr("attachment")).show();
                break;
              default:
                icon.replaceWithSpinner();
                button.trigger("click");
                break;
            }
          }
        }));
        if(name === "default"){
          icon.css({
            transform: "scaleY(-1)"
          });
        }else if (name === "back"){
          icon.css({
            transform: "scaleX(-1)"
          });
        }
        button.hide();
      });
      if(self.area.hasClass("centered")){
        self.area.children().css({
          width: (100 / self.area.children().length)+"%"
        });
      }
    }

  });

  return ButtonSubmit;

})();