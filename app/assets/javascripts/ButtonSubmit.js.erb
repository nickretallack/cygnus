ButtonSubmit = (function(){

    var self;

    var ButtonSubmit = function(element){

        self = this;

        self.form = element;
        self.area = element.siblings(".button-area").safeAdd();
        self.icons = JSON.parse('<%= CONFIG[:button_icons].to_json %>');
        self.initialize();

    };

    Make.extend(ButtonSubmit.prototype, {

        initialize: function(){
            $.each(self.icons, function(name, icon){
                var button = self.form.children("#" + name);
                if(!button.exists()) return;
                var size = /small|medium-small|medium|large/.exec(button.attr("class"));
                size = size === null? "medium-small" : size.first();
                if(self.form.attr("edit")){
                    var form = $("#" + self.form.attr("edit")).safeAdd();
                    if(form !== undefined){
                        switch(name){
                            case "edit":
                                var on = form.children(".on");
                                var off = form.children(".off");
                                on.hide();
                                button.on("click.ButtonSubmit", function(event){
                                    pause(event);
                                    off.hide();
                                    on.show();
                                });
                                break;
                            case "save":
                                button.on("click.ButtonSubmit", function(event){
                                    pause(event);
                                    form.submit();
                                });
                                break;
                        }
                    }
                }
                self.area.append($("<div />").append(
                    $("<i />", {
                        class: "material-icons " + size,
                        id: button.attr("value"),
                        text: icon,
                        title: name.capitalize(),
                        css: {
                            cursor: "pointer",
                            marginLeft: "3%",
                            marginRight: "3%"
                        }
                    }).on("click.submit", function(event){
                        pause(event);
                        button.trigger("click");
                    }),
                    $("<label />", {
                        for: button.attr("value"),
                        text: button.attr("value")
                    })
                ));
                button.remove();
            });
            var attachmentButton = self.area.children().filter(function(index, element){
                return $(element).prop("textContent") === '<%= CONFIG[:button_icons][:create] %>';
            });
            if(attachmentButton.exists()) attachmentButton.appendTo(self.area);
        }

    });

    return ButtonSubmit;

})();